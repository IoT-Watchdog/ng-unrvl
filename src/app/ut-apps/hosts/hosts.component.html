<h2>Hosts overview</h2>
<div>
  <button (click)="reload()">Reload</button>
  Own Location:
  <label for="lat">Lat:</label>
  <input
    type="text"
    class="form-control"
    name="lat"
    id="lat"
    [(ngModel)]="ownLat"
  />
  <label for="lon">Lon:</label>
  <input
    type="text"
    class="form-control"
    name="lon"
    id="lon"
    [(ngModel)]="ownLon"
  />
  <label for="ownCity">Search:</label>
  <input
    type="text"
    class="form-control"
    name="ownCity"
    id="ownCity"
    [(ngModel)]="ownCity"
  />
  <button (click)="locSearch()">Go</button>
</div>

<div class="flowcont">
  <h3>Internet Connections</h3>
  <table class="flows" *ngIf="inetCons && inetCons.length">
    <tr>
      <!-- <th>idx</th> -->
      <th>Source IP</th>
      <th>Dest. IP</th>
      <th>remote hostname</th>
      <th>remote location</th>
      <th>L4 Prot</th>
      <th>Src. Port</th>
      <th>Dest. Port</th>
      <th>L7 Protocol</th>
      <!-- <th>Begin</th> -->
      <th>Last Transfer</th>
      <th>Duration (s)</th>
      <th>In</th>
      <th>Out</th>
    </tr>
    <tr *ngFor="let flow of inetCons">
      <!-- <td>{{ flow.idx }}</td> -->
      <td class="r">{{ flow.IP_SRC_ADDR_str }}</td>
      <td class="r">
        {{ flow.IP_DST_ADDR_str }}
        <a
          href="{{
            globalSettings.server.baseurl
          }}:3000/lua/host_details.lua?host={{ flow.IP_DST_ADDR_str }}"
          target="_blank"
          ><img class="ntop" src="/assets/ntop_link.png"
        /></a>
      </td>
      <td>
        <span
          >{{
            ipNames[flow.IP_DST_ADDR_str]
              ? ipNames[flow.IP_DST_ADDR_str]
              : ipNames[flow.IP_SRC_ADDR_str]
              ? ipNames[flow.IP_SRC_ADDR_str]
              : '...'
          }}
        </span>
      </td>
      <td>
        <span *ngIf="ipLocations[flow.IP_SRC_ADDR_str]"
          >{{ ipLocations[flow.IP_SRC_ADDR_str]['isoCode']
          }}{{
            ipLocations[flow.IP_SRC_ADDR_str]['city']
              ? ', ' + ipLocations[flow.IP_SRC_ADDR_str]['city']
              : ''
          }}{{
            ipLocations[flow.IP_SRC_ADDR_str]['state']
              ? ', ' + ipLocations[flow.IP_SRC_ADDR_str]['state']
              : ''
          }}
        </span>
        <span *ngIf="ipLocations[flow.IP_DST_ADDR_str]"
          >{{ ipLocations[flow.IP_DST_ADDR_str]['isoCode']
          }}{{
            ipLocations[flow.IP_DST_ADDR_str]['city']
              ? ', ' + ipLocations[flow.IP_DST_ADDR_str]['city']
              : ''
          }}{{
            ipLocations[flow.IP_DST_ADDR_str]['state']
              ? ', ' + ipLocations[flow.IP_DST_ADDR_str]['state']
              : ''
          }}
        </span>
      </td>
      <td>{{ flow.prototext }}</td>
      <td class="r">{{ flow.L4_SRC_PORT }}</td>
      <td class="r">{{ flow.L4_DST_PORT }}</td>
      <td>{{ flow.L7prototext }}</td>
      <!-- <td>{{ flow.fromdate | date: 'dd.MM.yy HH:mm:ss' }}</td> -->
      <td>{{ flow.enddate | date: 'dd.MM.yy HH:mm:ss' }}</td>
      <td class="r">{{ flow.duration }}</td>
      <td class="r">{{ flow.inb_s }}B</td>
      <td class="r">{{ flow.outb_s }}B</td>
    </tr>
  </table>
  <h3>Local Connections</h3>
  <table class="flows" *ngIf="localCons && localCons.length">
    <tr>
      <!-- <th>idx</th> -->
      <th>Source IP</th>
      <th>Dest. IP</th>
      <th>remote hostname</th>
      <th>L4 Prot</th>
      <th>Src. Port</th>
      <th>Dest. Port</th>
      <th>L7 Protocol</th>
      <!-- <th>Begin</th> -->
      <th>Last Transfer</th>
      <th>Duration (s)</th>
      <th>In</th>
      <th>Out</th>
    </tr>
    <tr *ngFor="let flow of localCons">
      <!-- <td>{{ flow.idx }}</td> -->
      <td class="r">{{ flow.IP_SRC_ADDR_str }}</td>
      <td class="r">
        {{ flow.IP_DST_ADDR_str }}
        <a
          href="{{
            globalSettings.server.baseurl
          }}:3000/lua/host_details.lua?host={{ flow.IP_DST_ADDR_str }}"
          target="_blank"
          ><img class="ntop" src="/assets/ntop_link.png"
        /></a>
      </td>
      <td>
        <span
          >{{
            ipNames[flow.IP_DST_ADDR_str]
              ? ipNames[flow.IP_DST_ADDR_str]
              : ipNames[flow.IP_SRC_ADDR_str]
              ? ipNames[flow.IP_SRC_ADDR_str]
              : '...'
          }}
        </span>
      </td>
      <td>{{ flow.prototext }}</td>
      <td class="r">{{ flow.L4_SRC_PORT }}</td>
      <td class="r">{{ flow.L4_DST_PORT }}</td>
      <td>{{ flow.L7prototext }}</td>
      <!-- <td>{{ flow.fromdate | date: 'dd.MM.yy HH:mm:ss' }}</td> -->
      <td>{{ flow.enddate | date: 'dd.MM.yy HH:mm:ss' }}</td>
      <td class="r">{{ flow.duration }}</td>
      <td class="r">{{ flow.inb_s }}B</td>
      <td class="r">{{ flow.outb_s }}B</td>
    </tr>
  </table>
</div>
<!--
<div *ngFor="let entry of ipNames | keyvalue">
  {{ entry.key }} : {{ entry.value }}
</div> -->

<!-- {{ sqlresult[0] }}  *ngIf="ipNames[flow.IP_DST_ADDR_str]"-->

<div class="fs-container">
  <app-map [x]="15.46" [y]="47.07" [z]="3" [layers]="layers"></app-map>
</div>
